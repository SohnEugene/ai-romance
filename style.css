/* AI Romance - Responsive Styles (Fixed) */

/* =========================================
   1. 기본 설정 및 레이아웃
   ========================================= */
body {
    /* 기본 배경색 */
    background: linear-gradient(135deg, #ff69b4 0%, #d896ff 50%, #b19cd9 100%);
    background-color: #ff69b4;

    /* 배경 이미지 공통 속성 */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transition: background-image 0.3s ease-in-out;

    /* 레이아웃 */
    margin: 0 !important;
    padding: 0 !important;
    min-height: 100vh;
    position: relative;

    /* 폰트 */
    font-size: clamp(12px, 1.3vw, 16px);
    
    /* 스크롤바 완전 제거 */
    overflow: hidden !important;

    /* 드래그 방지 */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* 입력창 예외 처리 */
input, textarea {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
    outline: none;
}

/* 기본 UI 숨김 */
#ui-bar { display: none !important; }
#story { margin-left: 0 !important; }

/* Story 컨테이너 */
#story {
    width: 100%;
    height: 100vh;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    pointer-events: none;
}

/* 패시지 영역 */
#passages {
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
    margin-bottom: 2vh;
    position: relative;
    z-index: 10;
    pointer-events: auto;
}


/* =========================================
   2. 대화창 디자인 (Passage Box)
   ========================================= */
.passage {
    /* 크기 */
    height: 20vh;
    min-height: 200px;
    width: 90%;
    margin: 0 auto;

    /* 디자인 */
    background:
        linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(230, 210, 255, 0.6)) padding-box,
        linear-gradient(135deg, rgba(255, 105, 180, 0.6), rgba(216, 150, 255, 0.6)) border-box;
    border: 5px solid transparent;
    border-radius: 15px;
    position: relative;

    /* 그림자 효과 */
    box-shadow:
        0 0 20px rgba(255, 105, 180, 0.4),
        0 0 40px rgba(216, 150, 255, 0.3),
        inset 0 -2px 10px rgba(216, 150, 255, 0.2);

    /* 여백 설정 */
    padding: 2.2vh 1.8vw;
    padding-bottom: 60px; /* [수정됨] 세미콜론 추가 */
    box-sizing: border-box;

    /* 텍스트 설정 */
    text-align: left;
    color: #000;
    font-size: clamp(11px, 0.9rem, 15px);
    line-height: 1.4;
    overflow: hidden !important;
    white-space: normal;

    /* [핵심 수정] 배경의 mix-blend-mode가 텍스트에 영향 주지 않도록 격리 */
    isolation: isolate; 
    z-index: 10; /* 배경보다 확실히 위에 */
}

/* 공백 제거 */
.passage p { margin: 0; padding: 0; margin-bottom: 0.5em; }
.passage h1, .passage h2, .passage h3 { margin: 0.2em 0; }
.passage hr { margin: 0.5em 0; }
.passage > br:first-child { display: none; }


/* =========================================
   3. 텍스트 & 이름표 & 링크 (VN UI)
   ========================================= */
#typewriter-box {
    font-family: 'Nanum Gothic', sans-serif;
    font-size: 1.2em;
    line-height: 1.4;
    white-space: pre-wrap;
    background-color: transparent;
    color: #000;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    padding: 10px;
    padding-right: 1px;

    /* [핵심 수정] 렌더링 성능 최적화 및 레이어 분리 */
    transform: translateZ(0);  /* 텍스트를 별도의 GPU 레이어로 분리 */
    will-change: contents;     /* 내용이 자주 바뀐다고 브라우저에 알림 */
    backface-visibility: hidden; /* 깜빡임 방지 */
}

.typing-line { margin: 0; }

.next-icon {
    display: inline-block;
    margin-left: 8px;
    font-size: 1em;
    animation: blink-icon 1.5s infinite;
    cursor: pointer;
}
@keyframes blink-icon {
    0%, 100% { opacity: 1; transform: translateY(0); }
    50% { opacity: 0.3; transform: translateY(-2px); }
}

/* 이름표 영역 */
#name-zone {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30px;
    
    background-color: rgba(255, 255, 255, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 0 0 13px 13px;
    
    display: flex;
    align-items: center;
    padding-left: 25px;
    box-sizing: border-box;
    
    color: #333;
    font-weight: bold;
    font-size: 1.0rem;
    pointer-events: none;
}

/* 미나: Gemini Blue */
.name-mina {
    color: #2979FF !important; 
    text-shadow: 0 0 2px rgba(41, 121, 255, 0.2);
}

/* 채진: ChatGPT Mint/Green */
.name-chaejin {
    color: #10A37F !important;
    text-shadow: 0 0 2px rgba(16, 163, 127, 0.2);
}

/* 클라라: Claude Orange */
.name-clara {
    color: #DA7756 !important;
    text-shadow: 0 0 2px rgba(218, 119, 86, 0.2);
}

/* 링크 버튼 컨테이너 */
#next-btn {
    position: absolute;
    margin-left: 10px;
    bottom: 35px;
    z-index: 20;
}


/* =========================================
   4. 배경 및 캐릭터
   ========================================= */
body:has(.passage[data-tags~="bg1"]) { background-image: url('assets/background/bg1.png'); }
body:has(.passage[data-tags~="bg2"]) { background-image: url('assets/background/bg2.png'); }
body:has(.passage[data-tags~="bg3"]) { background-image: url('assets/background/bg3.png'); }
body:has(.passage[data-tags~="bg4"]) { background-image: url('assets/background/bg4.png'); }
body:has(.passage[data-tags~="bg5"]) { background-image: url('assets/background/bg5.png'); }
body:has(.passage[data-tags~="bg6"]) { background-image: url('assets/background/bg6.png'); }
body:has(.passage[data-tags~="bg7"]) { background-image: url('assets/background/bg7.png'); }
body:has(.passage[data-tags~="bg8"]) { background-image: url('assets/background/bg8.png'); }
body:has(.passage[data-tags~="bg9"]) { background-image: url('assets/background/bg9.png'); }
body:has(.passage[data-tags~="bg10"]) { background-image: url('assets/background/bg10.png'); }
body:has(.passage[data-tags~="bg11"]) { background-image: url('assets/background/bg11.png'); }
body:has(.passage[data-tags~="bg12"]) { background-image: url('assets/background/bg12.png'); }
body:has(.passage[data-tags~="bg13"]) { background-image: url('assets/background/bg13.png'); }
body:has(.passage[data-tags~="bg14"]) { background-image: url('assets/background/bg14.png'); }
body:has(.passage[data-tags~="bg15"]) { background-image: url('assets/background/bg15.png'); }
body:has(.passage[data-tags~="bg16"]) { background-image: url('assets/background/bg16.png'); }
body:has(.passage[data-tags~="bg17"]) { background-image: url('assets/background/bg17.png'); }
body:has(.passage[data-tags~="bg18"]) { background-image: url('assets/background/bg18.png'); }

/* "black" 태그: 배경 검은색 강제 */
body:has(.passage[data-tags~="black"]) {
    background-image: none !important;
    background-color: #000 !important;
}

/* 캐릭터 이미지 */
#character-image {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    height: 90vh;
    width: auto;
    max-width: 100%;
    object-fit: contain;
    z-index: 1;
    pointer-events: none;
    
    opacity: 0;
    animation: charFadeIn 0.5s ease-out forwards;
    animation-delay: 0.3s;
}


/* =========================================
   5. 호감도 UI (Right Sidebar)
   ========================================= */
#right-sidebar {
    position: fixed;
    top: 2vh; right: 1vw;
    width: 20vw; min-width: 180px; max-width: 250px;
    padding: 1.5vh 1.5vw;
    
    background-color: rgba(0, 0, 0, 0.8);
    border: 2px solid #ff69b4;
    border-radius: 10px;
    z-index: 5000 !important;
    
    color: white;
    font-family: sans-serif;
    box-sizing: border-box;
}

/* 사이드바 내부 버튼 스타일 */
#right-sidebar button {
    width: 100%;
    background-color: transparent !important;
    border: 1px solid #ff69b4;
    color: white;
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
    font-family: 'Nanum Gothic', sans-serif;
    font-size: 0.9rem;
    transition: all 0.3s;
    
    margin-top: 5px;
    display: inline-block;
}

#right-sidebar button:hover {
    background-color: #ff69b4 !important;
    color: white !important;
    border-color: #ff1493 !important;
}

.sidebar-title { text-align: center; font-weight: bold; font-size: 1.1rem; margin-bottom: 1.5vh; border-bottom: 1px solid #555; padding-bottom: 1vh; }
.char-box { margin-bottom: 1.5vh; }
.char-name { display: inline-block; width: 30%; font-weight: bold; font-size: 1rem; }
.char-score { float: right; font-size: 0.9rem; color: #ddd; }
.profile-section { display: flex; flex-direction: column; gap: 10px; }

progress { width: 100%; height: 1.5vh; appearance: none; }
progress::-webkit-progress-bar { background-color: #444; border-radius: 5px; }
progress::-webkit-progress-value { background-color: #ff69b4; border-radius: 5px; transition: width 0.5s; }


/* =========================================
   6. 세이브/로드 메뉴 (Pause Screen)
   ========================================= */
#pause-screen {
    display: none;
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background-color: rgba(0, 0, 0, 0.85);
    z-index: 100000;
    
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    
    color: #fff; font-family: 'Nanum Gothic', sans-serif;
}

.pause-title { font-size: 2rem; margin-bottom: 40px; color: #ff69b4; font-weight: bold; }
.pause-buttons { display: flex; flex-direction: column; gap: 20px; width: 200px; margin-bottom: 10px; height: auto; }

.pause-main-btn {
    padding: 15px 0; font-size: 1.2rem;
    background: transparent; border: 2px solid #fff; color: #fff;
    cursor: pointer; transition: all 0.3s; /* [수정됨] 오타 제거 */
    border-radius: 5px;
}
.pause-main-btn:hover { background: #ff69b4; border-color: #ff69b4; }

#btn-restart:hover {
    background-color: #ff4444 !important;
    color: white !important;
    border-color: #ff0000 !important;
}

#pause-message {
    width: 100%; text-align: center;
    height: 30px; margin-top: 10px; margin-bottom: 30px;
    color: #ff69b4; font-weight: bold; line-height: 30px;
}

.slot-container { display: flex; flex-direction: row; gap: 15px; width: 80%; justify-content: center; }
.save-slot {
    width: 120px; height: 120px; border: 2px solid #555; border-radius: 10px;
    background: rgba(255, 255, 255, 0.1); cursor: pointer;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    font-size: 0.9rem; transition: all 0.2s; text-align: center; padding: 5px;
    box-sizing: border-box;
}
.save-slot:hover { border-color: #aaa; background: rgba(255, 255, 255, 0.2); }
.save-slot.selected { border-color: #ff69b4; background: rgba(255, 105, 180, 0.2); box-shadow: 0 0 15px #ff69b4; }
.slot-id { font-weight: bold; margin-bottom: 5px; }
.slot-info { font-size: 0.8rem; color: #ccc; }
.slot-empty { color: #666; font-style: italic; }

#story.paused { pointer-events: none; }
#pause-screen { pointer-events: auto; }


/* =========================================
   7. 타이틀 화면 (UI 재구성)
   ========================================= */
body[data-tags~="title_screen"] {
    background-image: url('assets/background/bg1.png'); 
    background-size: cover;
    background-position: center;
}
body[data-tags~="title_screen"] .passage {
    background: transparent !important; border: none !important; box-shadow: none !important;
    padding: 0 !important; margin: 0 !important;
    width: 100%; height: 100%; max-width: none;
    display: block; animation: fadeInUp 0.6s ease-out;
}
.title-ui-container {
    position: absolute; bottom: 20%; left: 0%;
    display: flex; flex-direction: column; gap: 10px; align-items: flex-start;
}
.title-label {

    font-family: 'Nanum Gothic', sans-serif;

    font-size: 1.7rem;

    font-weight: bold;

    color: #333; /* 잘 보이게 짙은 색 */

    margin-left: 18px;

}
.input-wrapper { display: flex; flex-direction: row; align-items: center; gap: 8px; }
.title-ui-container input[type="text"] {
    width: 150px; height: 30px; background-color: #fff; border: 3px solid #000; border-radius: 10px;
    color: #000; font-size: 1.3rem; font-weight: bold; text-align: center; box-shadow: none; outline: none;
}
.title-ui-container input[type="text"]:hover, .title-ui-container input[type="text"]:focus {
    background-color: #fff !important; border-color: #000 !important; box-shadow: none !important;
}
.title-ui-container button {
    width: 80px; height: 50px; background-color: #7d6cd6; border: 3px solid #fff; border-radius: 10px;
    color: white; font-weight: normal; font-size: 1.2rem; line-height: 1;
    cursor: pointer; transition: all 0.2s ease; display: flex; justify-content: center; align-items: center; padding: 0;
}
.title-ui-container button:hover {
    background-color: #9b8cfc; transform: scale(1.05);
    box-shadow: 0 0 10px rgba(125, 108, 214, 0.6); border-color: #fff;
}


/* =========================================
   8. 프로필 페이지 UI (Tag: Profile)
   ========================================= */
body[data-tags~="Profile"] #story { align-items: center; justify-content: center; }
body[data-tags~="Profile"] #passages {
    width: 50vw; max-width: 600px; margin: 0; position: absolute; right: 20vw; z-index: 20;
}
body[data-tags~="Profile"] .passage {
    height: auto; max-height: 80vh; min-height: 60vh;
    background: rgba(255, 255, 255, 0.9); border: 3px solid #ff69b4; border-radius: 20px;
    box-shadow: 5px 5px 15px rgba(0,0,0,0.2); padding: 40px; overflow: hidden !important;
    animation: fadeInUp 0.8s ease-out;
}
body[data-tags~="Profile"] .passage h1, body[data-tags~="Profile"] .passage h2 {
    color: #ff69b4; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px;
}
body[data-tags~="Profile"] .passage button {
    margin-top: 30px; width: 100%; padding: 15px; background-color: #ff69b4; color: white;
    border: none; border-radius: 10px; font-size: 1.1em; font-weight: bold;
    cursor: pointer; transition: background 0.3s; display: block;
}
body[data-tags~="Profile"] .passage button:hover { background-color: #ff1493; }

/* 프로필 캐릭터 이미지 (왼쪽) */
body[data-tags~="Profile"]::before {
    content: ''; position: fixed; bottom: 0; left: 5vw; width: 45vw; height: 90vh;
    background-repeat: no-repeat; background-position: bottom center; background-size: contain;
    z-index: 5; pointer-events: none; animation: fadeInLeft 1s ease-out;
}
body[data-tags~="Profile"]:has(.passage[data-tags~="미나"])::before { background-image: url('assets/mn/1.png'); }
body[data-tags~="Profile"]:has(.passage[data-tags~="채진"])::before { background-image: url('assets/cg/1.png'); }
body[data-tags~="Profile"]:has(.passage[data-tags~="클라라"])::before { background-image: url('assets/ry/1.png'); }
body[data-tags~="Profile"] #character-image { display: none !important; }

@keyframes fadeInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }


/* =========================================
   [통합] 특수 연출 효과 (Visual Effects)
   ========================================= */

/* 1. 검은 막 (Blackout Overlay) */
#blackout-overlay {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: 99990; 
    background-color: #000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
}

#blackout-overlay.active {
    opacity: 1;
    pointer-events: all; /* 시야 차단 시 클릭도 차단 */
}

/* 2. 스토리 본문 (텍스트 영역) */
#story {
    transition: opacity 1s ease-in;
    opacity: 1;
}

/* [핵심] HTML 태그에 이 클래스가 있으면 텍스트를 강제로 숨김 (깜빡임 방지) */
html.story-hidden #story {
    opacity: 0 !important;
    pointer-events: none !important;
    visibility: hidden !important; /* 렌더링 단계에서 아예 제외 */
}

/* =========================================
   [Glitch Effect] (Tag: glitch) - 수정됨
   ========================================= */

/* -------------------------------------
   Layer 1: 일렁이는 효과 (Distortion / RGB)
   - 원본 배경을 복사해서 살짝 옆으로 밀고(Translate),
   - 얇게 잘라내서(Clip-path) 보여줌으로써 '찢어진' 느낌을 냄
   ------------------------------------- */
body[data-tags~="glitch"]::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 5; 
    pointer-events: none;

    /* 배경 이미지 상속 */
    background-image: inherit; 
    background-size: cover;
    background-position: center;
    
    /* 붉은색 틴트 + 혼합 모드 (색상 왜곡) */
    filter: url(#alphaRed) contrast(150%); 
    mix-blend-mode: hard-light;
    opacity: 0.7;

    /* [핵심] steps(2)와 매우 짧은 시간(0.2s)을 사용하여 미친듯이 떨리게 함 */
    animation: glitch-anim-distort 0.3s infinite linear alternate-reverse;

    will-change: clip-path, transform;
}

/* -------------------------------------
   Layer 2: 검은색 파편 (Black Flash)
   - 화면 군데군데 검은 구멍이 '깜빡'거리는 효과
   ------------------------------------- */
body[data-tags~="glitch"]::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 6; 
    pointer-events: none;

    background-color: #000;
    
    /* [핵심] steps(1)을 사용하여 '서서히' 커지는 게 아니라 '팟!'하고 바뀜 */
    animation: glitch-anim-black 2.5s infinite steps(1);

    will-change: clip-path;
}

/* 글리치 중 호감도 UI 숨김 */
body[data-tags~="glitch"] #right-sidebar { display: none !important; }


/* =====================================
   [Keyframes] 애니메이션 (스냅 효과 강화)
   inset(Top Right Bottom Left)
   Top + Bottom 값이 100%에 가까울수록 '얇은 선'이 됩니다.
   ===================================== */

/* 1. 일렁임 (얇은 가로줄이 빠르게 위아래로 튐) */
@keyframes glitch-anim-distort {
  0% {
    clip-path: inset(10% 0 85% 0); /* 5% 두께의 선 */
    transform: translate(-5px, 0);
  }
  20% {
    clip-path: inset(80% 0 15% 0); /* 5% 두께 */
    transform: translate(5px, 0);
  }
  40% {
    clip-path: inset(30% 0 60% 0); /* 10% 두께 */
    transform: translate(-5px, 0);
  }
  60% {
    clip-path: inset(60% 0 35% 0); /* 5% 두께 */
    transform: translate(5px, 0);
  }
  80% {
    clip-path: inset(5% 0 90% 0);  /* 5% 두께 */
    transform: translate(-5px, 0);
  }
  100% {
    clip-path: inset(45% 0 50% 0); /* 5% 두께 */
    transform: translate(5px, 0);
  }
}

/* 2. 검은색 깜빡임 (불규칙하게 나타났다 사라짐) */
/* steps(1)을 썼기 때문에 중간 과정 없이 컷! 컷! 바뀝니다. */
@keyframes glitch-anim-black {
  0% { clip-path: inset(100% 0 0 0); } /* 안 보임 */
  
  5% { clip-path: inset(10% 0 60% 0); } /* 상단 두꺼운 띠 */
  10% { clip-path: inset(100% 0 0 0); } /* 사라짐 */
  
  25% { clip-path: inset(80% 0 5% 0); } /* 하단 얇은 띠 */
  30% { clip-path: inset(100% 0 0 0); } /* 사라짐 */
  
  50% { clip-path: inset(30% 60% 30% 10%); } /* 화면 중앙 왼쪽 사각형 */
  55% { clip-path: inset(100% 0 0 0); } /* 사라짐 */
  
  70% { clip-path: inset(0 0 0 0); } /* [임팩트] 전체 검은 화면 (0.1초간) */
  72% { clip-path: inset(100% 0 0 0); } /* 사라짐 */
  
  85% { clip-path: inset(0 0 90% 0); } /* 최상단 얇은 띠 */
  90% { clip-path: inset(100% 0 0 0); } /* 사라짐 */
}
/* 10. ESC 키 안내 문구 */
#esc-hint {
    position: fixed; top: 15px; left: 15px; z-index: 2000;
    color: rgba(255, 255, 255, 0.5); font-family: 'Nanum Gothic', sans-serif;
    font-size: 0.9rem; font-weight: bold; pointer-events: none;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
}
body[data-tags~="title_screen"] #esc-hint { display: none !important; }

/* 11. "All" 태그 전용 캐릭터 컨테이너 */
#all-chars-container {
    position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 100%; height: 90vh; z-index: 1; pointer-events: none;
    display: flex; justify-content: center; align-items: flex-end;
}
.char-sprite-group {
    height: 100%; width: auto; object-fit: contain;
    margin-left: -60px; margin-right: -60px;
    animation: fadeChar 0.5s ease-out; animation-delay: 0.3s; opacity: 0; animation-fill-mode: forwards;
}
@keyframes fadeChar { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes charFadeInSingle { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }

/* 단일 캐릭터 애니메이션 */
#character-image { animation-name: charFadeInSingle; }